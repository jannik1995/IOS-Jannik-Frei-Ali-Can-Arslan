import Foundation
import SwiftUI

class EmojiMemoryGameViewModel: ObservableObject {
    
    init() {
        model = EmojiMemoryGameViewModel.createMemoryGame(EmojiSet: 2, Difficulty: Difficulty.easy )
    }
    
    @Published private var model: MemoryGame<CardObjectWrapper>
    
    
    static func createMemoryGame(EmojiSet: Int,Difficulty: Difficulty)->MemoryGame<CardObjectWrapper> {
    
        let colors = [Color.red, Color.blue, Color.green, Color.yellow, Color.black, Color.pink, Color.brown, Color.cyan, Color.purple]
    
        var shapes:[AnyView] = []
        
        for i in 0..<colors.count{
            shapes.append(AnyView(Rectangle().fill(colors[i]).frame(width: 40, height: 40)))
            shapes.append(AnyView(Circle().fill(colors[i]).frame(width: 40, height: 40)))
            shapes.append(AnyView(Hexagon().fill(colors[i]).frame(width: 40, height: 40)))
            shapes.append(AnyView(Triangle().fill(colors[i]).frame(width: 40, height: 40)))
        }
        
        var themes: [[Any]] = [
            ["ðŸ˜€","ðŸ˜¬","ðŸ˜","ðŸ˜‚","ðŸ˜ƒ","ðŸ˜„","ðŸ˜…","ðŸ˜†","ðŸ˜‡","ðŸ˜‰","ðŸ˜Š","ðŸ™‚","ðŸ™ƒ","â˜ºï¸","ðŸ˜‹","ðŸ˜Œ","ðŸ˜","ðŸ˜˜","ðŸ˜—","ðŸ˜™","ðŸ˜š","ðŸ˜œ","ðŸ˜","ðŸ˜›","ðŸ¤‘","ðŸ¤“","ðŸ˜Ž","ðŸ¤—","ðŸ˜","ðŸ˜¶","ðŸ˜","ðŸ˜‘","ðŸ˜’","ðŸ™„","ðŸ¤”","ðŸ˜³","ðŸ˜ž","ðŸ˜Ÿ","ðŸ˜ ","ðŸ˜¡","ðŸ˜”","ðŸ˜•","ðŸ™","â˜¹ï¸","ðŸ˜£","ðŸ˜–","ðŸ˜«","ðŸ˜©","ðŸ˜¤","ðŸ˜®","ðŸ˜±","ðŸ˜¨","ðŸ˜°","ðŸ˜¯","ðŸ˜¦","ðŸ˜§","ðŸ˜¢","ðŸ˜¥","ðŸ˜ª","ðŸ˜“","ðŸ˜­","ðŸ˜µ","ðŸ˜²","ðŸ¤","ðŸ˜·","ðŸ¤’","ðŸ¤•","ðŸ˜´"],
            ["ðŸ¶","ðŸ±","ðŸ­","ðŸ¹","ðŸ°","ðŸ»","ðŸ¼","ðŸ¨","ðŸ¯","ðŸ¦","ðŸ®","ðŸ·","ðŸ½","ðŸ¸","ðŸ™","ðŸµ","ðŸ™ˆ","ðŸ™‰","ðŸ™Š","ðŸ’","ðŸ”","ðŸ§","ðŸ¦","ðŸ¤","ðŸ£","ðŸ¥","ðŸº","ðŸ—","ðŸ´","ðŸ¦„","ðŸ","ðŸ›","ðŸŒ","ðŸž","ðŸœ","ðŸ•·","ðŸ¦‚","ðŸ¦€","ðŸ","ðŸ¢","ðŸ ","ðŸŸ","ðŸ¡","ðŸ¬","ðŸ³","ðŸ‹","ðŸŠ","ðŸ†","ðŸ…","ðŸƒ","ðŸ‚","ðŸ„","ðŸª","ðŸ«","ðŸ˜","ðŸ","ðŸ","ðŸ‘","ðŸŽ","ðŸ–","ðŸ€","ðŸ","ðŸ“","ðŸ¦ƒ","ðŸ•Š","ðŸ•","ðŸ©","ðŸˆ","ðŸ‡","ðŸ¿","ðŸ‰","ðŸ²"],
            ["ðŸ‡¦ðŸ‡«","ðŸ‡¦ðŸ‡½","ðŸ‡¦ðŸ‡±","ðŸ‡©ðŸ‡¿","ðŸ‡¦ðŸ‡¸","ðŸ‡¦ðŸ‡©","ðŸ‡¦ðŸ‡´","ðŸ‡¦ðŸ‡®","ðŸ‡¦ðŸ‡¶","ðŸ‡¦ðŸ‡¬","ðŸ‡¦ðŸ‡·","ðŸ‡¦ðŸ‡²","ðŸ‡¦ðŸ‡¼","ðŸ‡¦ðŸ‡º","ðŸ‡¦ðŸ‡¹","ðŸ‡¦ðŸ‡¿","ðŸ‡§ðŸ‡¸","ðŸ‡§ðŸ‡­","ðŸ‡§ðŸ‡©","ðŸ‡§ðŸ‡§","ðŸ‡§ðŸ‡¾","ðŸ‡§ðŸ‡ª","ðŸ‡§ðŸ‡¿","ðŸ‡§ðŸ‡¯","ðŸ‡§ðŸ‡²","ðŸ‡§ðŸ‡¹","ðŸ‡§ðŸ‡´","ðŸ‡§ðŸ‡¶","ðŸ‡§ðŸ‡¦","ðŸ‡§ðŸ‡¼","ðŸ‡§ðŸ‡·","ðŸ‡®ðŸ‡´","ðŸ‡»ðŸ‡¬","ðŸ‡§ðŸ‡³","ðŸ‡§ðŸ‡¬","ðŸ‡§ðŸ‡«","ðŸ‡§ðŸ‡®","ðŸ‡¨ðŸ‡»","ðŸ‡°ðŸ‡­","ðŸ‡¨ðŸ‡²","ðŸ‡¨ðŸ‡¦","ðŸ‡®ðŸ‡¨","ðŸ‡°ðŸ‡¾","ðŸ‡¨ðŸ‡«","ðŸ‡¹ðŸ‡©","ðŸ‡¨ðŸ‡±","ðŸ‡¨ðŸ‡³","ðŸ‡¨ðŸ‡½","ðŸ‡¨ðŸ‡¨","ðŸ‡¨ðŸ‡´","ðŸ‡°ðŸ‡²","ðŸ‡¨ðŸ‡¬","ðŸ‡¨ðŸ‡©","ðŸ‡¨ðŸ‡°","ðŸ‡¨ðŸ‡·","ðŸ‡­ðŸ‡·","ðŸ‡¨ðŸ‡º","ðŸ‡¨ðŸ‡¼","ðŸ‡¨ðŸ‡¾","ðŸ‡¨ðŸ‡¿","ðŸ‡©ðŸ‡°","ðŸ‡©ðŸ‡¯","ðŸ‡©ðŸ‡²","ðŸ‡©ðŸ‡´","ðŸ‡ªðŸ‡¨","ðŸ‡ªðŸ‡¬","ðŸ‡¸ðŸ‡»","ðŸ‡¬ðŸ‡¶","ðŸ‡ªðŸ‡·","ðŸ‡ªðŸ‡ª","ðŸ‡ªðŸ‡¹","ðŸ‡ªðŸ‡º","ðŸ‡«ðŸ‡°","ðŸ‡«ðŸ‡´","ðŸ‡«ðŸ‡¯","ðŸ‡«ðŸ‡®","ðŸ‡«ðŸ‡·","ðŸ‡¬ðŸ‡«","ðŸ‡µðŸ‡«","ðŸ‡¹ðŸ‡«","ðŸ‡¬ðŸ‡¦","ðŸ‡¬ðŸ‡²","ðŸ‡¬ðŸ‡ª","ðŸ‡©ðŸ‡ª","ðŸ‡¬ðŸ‡­","ðŸ‡¬ðŸ‡®","ðŸ‡¬ðŸ‡·","ðŸ‡¬ðŸ‡±","ðŸ‡¬ðŸ‡©","ðŸ‡¬ðŸ‡µ","ðŸ‡¬ðŸ‡º","ðŸ‡¬ðŸ‡¹","ðŸ‡¬ðŸ‡¬","ðŸ‡¬ðŸ‡³","ðŸ‡¬ðŸ‡¼","ðŸ‡¬ðŸ‡¾","ðŸ‡­ðŸ‡¹","ðŸ‡­ðŸ‡³","ðŸ‡­ðŸ‡°","ðŸ‡­ðŸ‡º","ðŸ‡®ðŸ‡¸","ðŸ‡®ðŸ‡³","ðŸ‡®ðŸ‡©","ðŸ‡®ðŸ‡·","ðŸ‡®ðŸ‡¶","ðŸ‡®ðŸ‡ª","ðŸ‡®ðŸ‡²","ðŸ‡®ðŸ‡±","ðŸ‡®ðŸ‡¹","ðŸ‡¨ðŸ‡®","ðŸ‡¯ðŸ‡²","ðŸ‡¯ðŸ‡µ","ðŸ‡¯ðŸ‡ª","ðŸ‡¯ðŸ‡´","ðŸ‡°ðŸ‡¿","ðŸ‡°ðŸ‡ª","ðŸ‡°ðŸ‡®","ðŸ‡½ðŸ‡°","ðŸ‡°ðŸ‡¼","ðŸ‡°ðŸ‡¬","ðŸ‡±ðŸ‡¦","ðŸ‡±ðŸ‡»","ðŸ‡±ðŸ‡§","ðŸ‡±ðŸ‡¸","ðŸ‡±ðŸ‡·","ðŸ‡±ðŸ‡¾","ðŸ‡±ðŸ‡®","ðŸ‡±ðŸ‡¹","ðŸ‡±ðŸ‡º","ðŸ‡²ðŸ‡´","ðŸ‡²ðŸ‡°","ðŸ‡²ðŸ‡¬","ðŸ‡²ðŸ‡¼","ðŸ‡²ðŸ‡¾","ðŸ‡²ðŸ‡»","ðŸ‡²ðŸ‡±","ðŸ‡²ðŸ‡¹","ðŸ‡²ðŸ‡­","ðŸ‡²ðŸ‡¶","ðŸ‡²ðŸ‡·","ðŸ‡²ðŸ‡º","ðŸ‡¾ðŸ‡¹","ðŸ‡²ðŸ‡½","ðŸ‡«ðŸ‡²","ðŸ‡²ðŸ‡©","ðŸ‡²ðŸ‡¨","ðŸ‡²ðŸ‡³","ðŸ‡²ðŸ‡ª","ðŸ‡²ðŸ‡¸","ðŸ‡²ðŸ‡¦","ðŸ‡²ðŸ‡¿","ðŸ‡²ðŸ‡²","ðŸ‡³ðŸ‡¦","ðŸ‡³ðŸ‡·","ðŸ‡³ðŸ‡µ","ðŸ‡³ðŸ‡±","ðŸ‡³ðŸ‡¨","ðŸ‡³ðŸ‡¿","ðŸ‡³ðŸ‡®","ðŸ‡³ðŸ‡ª","ðŸ‡³ðŸ‡¬","ðŸ‡³ðŸ‡º","ðŸ‡³ðŸ‡«","ðŸ‡²ðŸ‡µ","ðŸ‡°ðŸ‡µ","ðŸ‡³ðŸ‡´","ðŸ‡´ðŸ‡²","ðŸ‡µðŸ‡°","ðŸ‡µðŸ‡¼","ðŸ‡µðŸ‡¸","ðŸ‡µðŸ‡¦","ðŸ‡µðŸ‡¬","ðŸ‡µðŸ‡¾","ðŸ‡µðŸ‡ª","ðŸ‡µðŸ‡­","ðŸ‡µðŸ‡³","ðŸ‡µðŸ‡±","ðŸ‡µðŸ‡¹","ðŸ‡µðŸ‡·","ðŸ‡¶ðŸ‡¦","ðŸ‡·ðŸ‡ª","ðŸ‡·ðŸ‡´","ðŸ‡·ðŸ‡º","ðŸ‡·ðŸ‡¼","ðŸ‡§ðŸ‡±","ðŸ‡¸ðŸ‡­","ðŸ‡°ðŸ‡³","ðŸ‡±ðŸ‡¨","ðŸ‡µðŸ‡²","ðŸ‡»ðŸ‡¨","ðŸ‡¼ðŸ‡¸","ðŸ‡¸ðŸ‡²","ðŸ‡¸ðŸ‡¹","ðŸ‡¸ðŸ‡¦","ðŸ‡¸ðŸ‡³","ðŸ‡·ðŸ‡¸","ðŸ‡¸ðŸ‡¨","ðŸ‡¸ðŸ‡±","ðŸ‡¸ðŸ‡¬","ðŸ‡¸ðŸ‡½","ðŸ‡¸ðŸ‡°","ðŸ‡¸ðŸ‡®","ðŸ‡¸ðŸ‡§","ðŸ‡¸ðŸ‡´","ðŸ‡¿ðŸ‡¦","ðŸ‡¬ðŸ‡¸","ðŸ‡°ðŸ‡·","ðŸ‡¸ðŸ‡¸","ðŸ‡ªðŸ‡¸","ðŸ‡±ðŸ‡°","ðŸ‡¸ðŸ‡©","ðŸ‡¸ðŸ‡·","ðŸ‡¸ðŸ‡¿","ðŸ‡¸ðŸ‡ª","ðŸ‡¨ðŸ‡­","ðŸ‡¸ðŸ‡¾","ðŸ‡¹ðŸ‡¼","ðŸ‡¹ðŸ‡¯","ðŸ‡¹ðŸ‡¿","ðŸ‡¹ðŸ‡­","ðŸ‡¹ðŸ‡±","ðŸ‡¹ðŸ‡¬","ðŸ‡¹ðŸ‡°","ðŸ‡¹ðŸ‡´","ðŸ‡¹ðŸ‡¹","ðŸ‡¹ðŸ‡³","ðŸ‡¹ðŸ‡·","ðŸ‡¹ðŸ‡²","ðŸ‡¹ðŸ‡¨","ðŸ‡¹ðŸ‡»","ðŸ‡ºðŸ‡¬","ðŸ‡ºðŸ‡¦","ðŸ‡¦ðŸ‡ª","ðŸ‡¬ðŸ‡§","ðŸ‡ºðŸ‡¸","ðŸ‡»ðŸ‡®","ðŸ‡ºðŸ‡¾","ðŸ‡ºðŸ‡¿","ðŸ‡»ðŸ‡º","ðŸ‡»ðŸ‡¦","ðŸ‡»ðŸ‡ª","ðŸ‡»ðŸ‡³","ðŸ‡¼ðŸ‡«","ðŸ‡ªðŸ‡­","ðŸ‡¾ðŸ‡ª,","ðŸ‡¿ðŸ‡²","ðŸ‡¿ðŸ‡¼"]
        ]
        
        themes.append(shapes)
        
        for i in 0..<themes.count{
            for j in 0..<themes[i].count{
                themes[i][j] = CardObjectWrapper(id: j, obj: themes[i][j])
            }
        }
        
        let screenSize = Int(UIScreen.main.bounds.width)

        let cardAmount: Int = cardAmountDisplay(Difficulty: Difficulty, ScreenSize: screenSize)
        let playingTheme = themes[EmojiSet].shuffled()[..<(cardAmount)]
        
        return  MemoryGame<CardObjectWrapper>(numberOfPairsOfCards: playingTheme.count, cardContentFactory: { pairIndex in
            return playingTheme[pairIndex] as! CardObjectWrapper
        })
    }
    
    // MARK: - Access to the Model
    var cards: [MemoryGame<CardObjectWrapper>.Card]{
        return model.cards
    }
    
    // MARK: - Intents
    func choose(card: MemoryGame<CardObjectWrapper>.Card){
        model.choose(card: card)
    }
    
    func newGame(EmojiSet: Int,Difficulty: Difficulty){
       model = EmojiMemoryGameViewModel.createMemoryGame(EmojiSet: EmojiSet, Difficulty: Difficulty)
    }
    
    static func cardAmountDisplay(Difficulty: Difficulty, ScreenSize: Int) -> Int{
        var amount:Int = 0
        if(ScreenSize < 400){
            amount = Difficulty.rawValue
        } else {
            amount = Difficulty.rawValue * 2
        }
        return amount
    }
    
    func getScore()->Int{
        return model.scoreCounter
    }
    
    func getHighScore()->Int{
        return model.highScore
    }
    
}
